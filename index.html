<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cellframe Masternode Inspector</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Rubik:wght@400;500&family=Play:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="dashboard-header">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <div class="col">
                    <h1 class="mb-1 header-title">
                        Cellframe Masternode Inspector
                    </h1>
                    <p class="mb-0 header-subtitle">
                        Welcome to the Cellframe Masternode Inspector. Here you can monitor your masternodes effectively.
                    </p>
                </div>
                <div class="col-12 col-md-auto">
                    <div class="d-flex flex-column flex-md-row gap-2">
                        <button class="btn btn-secondary w-100 w-md-auto" onclick="nodeManager.showManageMetricsModal()">
                            <i class="fas fa-sliders me-2"></i> Manage Metrics
                        </button>
                        <button class="btn btn-secondary w-100 w-md-auto" onclick="showSettingsModal()">
                            <i class="fas fa-cog me-2"></i> Settings
                        </button>
                        <button class="btn btn-primary w-100 w-md-auto" onclick="showAddNodeModal()">
                            <span class="me-2">+</span> Add Node
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <div class="dashboard-nav" id="dashboardNav" style="display: none;">
        <div class="container-fluid">
            <div class="row align-items-center py-2">
                <div class="col-auto">
                    <div class="nav-section">
                        <label class="nav-label">Node:</label>
                        <div class="d-flex align-items-center">
                            <select class="form-select nav-select" id="nodeSelector">
                                <option value="">Select Node...</option>
                            </select>
                            <button class="btn btn-sm btn-danger ms-2" id="removeNodeBtn"
                                    onclick="nodeManager.removeCurrentNode()"
                                    style="display: none;"
                                    title="Remove Node">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-sm btn-primary ms-2" id="shareNodeBtn"
                                    onclick="nodeManager.shareCurrentNode()"
                                    style="display: none;"
                                    title="Share Node">
                                <i class="fas fa-share-nodes"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-auto" id="networkNavSection" style="display: none;">
                    <div class="nav-section">
                        <label class="nav-label">Network:</label>
                        <div class="network-pills" id="networkPills">
                            <!-- Network pills will be generated here -->
                        </div>
                    </div>
                </div>
                <div class="col-auto ms-auto" id="refreshSection" style="display: none;">
                    <button class="btn btn-outline-light btn-sm" id="refreshButton">
                        <span class="refresh-icon">‚ü≥</span> Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-4">
        <!-- System Info -->
        <div class="row mb-4" id="systemInfoSection" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">System Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="systemInfoCards">
                            <!-- System info cards will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Performance -->
        <div class="row mb-4" id="networkPerfSection" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Network Performance and Metrics</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="networkPerfCards">
                            <!-- Network performance cards will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Dashboard Content -->
        <div id="nodeContent">
            <!-- Node content will be dynamically generated -->
        </div>
    </div>

    <!-- Footer with Last Updated Timestamp -->
    <footer id="dashboardFooter" class="dashboard-footer" style="display: none;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 text-center">
                    <div id="lastUpdated" class="last-updated-info">
                        <i class="fas fa-clock me-2"></i>
                        <span>Last updated: </span>
                        <span id="lastUpdatedTime">Never</span>
                        <span class="ms-3">
                            <i class="fas fa-sync-alt me-1"></i>
                            <span>System: 30s | Network: 5min</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Add Node Modal -->
    <div class="modal fade" id="addNodeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Node</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addNodeForm" onsubmit="event.preventDefault(); addNode();">
                        <div class="mb-3">
                            <label for="nodeName" class="form-label">Node Name</label>
                            <input type="text" class="form-control" id="nodeName" required>
                        </div>
                        <div class="mb-3">
                            <label for="nodeUrl" class="form-label">API URL</label>
                            <input type="url" class="form-control" id="nodeUrl" placeholder="https://your-node.com" required>
                        </div>
                        <div class="mb-3">
                            <label for="apiToken" class="form-label">API Token</label>
                            <input type="text" class="form-control" id="apiToken" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-secondary" onclick="testNodeConnection()">Test Connection</button>
                    <button type="button" class="btn btn-primary" onclick="addNode()">Add Node</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Initial Setup Modal -->
    <div class="modal fade" id="setupModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Welcome to Cellframe Masternode Inspector</h5>
                </div>
                <div class="modal-body">
                    <p>To get started, please add your first masternode configuration:</p>
                    <form id="setupForm" onsubmit="event.preventDefault(); setupFirstNode();">
                        <div class="mb-3">
                            <label for="setupNodeName" class="form-label">Node Name</label>
                            <input type="text" class="form-control" id="setupNodeName" placeholder="My Masternode" required>
                        </div>
                        <div class="mb-3">
                            <label for="setupNodeUrl" class="form-label">API URL</label>
                            <input type="url" class="form-control" id="setupNodeUrl" placeholder="https://your-node.com" required>
                        </div>
                        <div class="mb-3">
                            <label for="setupApiToken" class="form-label">API Token</label>
                            <input type="text" class="form-control" id="setupApiToken" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="testSetupConnection()">Test Connection</button>
                    <button type="button" class="btn btn-primary" onclick="setupFirstNode()">Get Started</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Dashboard Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="settingsForm">
                        <div class="mb-4">
                            <h6 class="text-muted">Auto-Refresh Intervals</h6>
                            <div class="mb-3">
                                <label for="systemRefreshInterval" class="form-label">
                                    System Information Refresh
                                    <small class="text-muted d-block">How often to update system metrics (CPU, memory, uptime)</small>
                                </label>
                                <select class="form-select" id="systemRefreshInterval">
                                    <option value="15">15 seconds</option>
                                    <option value="30" selected>30 seconds</option>
                                    <option value="60">1 minute</option>
                                    <option value="120">2 minutes</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="networkRefreshInterval" class="form-label">
                                    Network Data Refresh
                                    <small class="text-muted d-block">How often to update charts, rewards, and network metrics</small>
                                </label>
                                <select class="form-select" id="networkRefreshInterval">
                                    <option value="60">1 minute</option>
                                    <option value="120">2 minutes</option>
                                    <option value="300" selected>5 minutes</option>
                                    <option value="600">10 minutes</option>
                                    <option value="900">15 minutes</option>
                                </select>
                            </div>
                            <div class="alert alert-info">
                                <small>
                                    <i class="fas fa-info-circle me-1"></i>
                                    Lower intervals provide more up-to-date information but may increase API usage.
                                    Changes take effect immediately.
                                </small>
                            </div>
                        </div>
                    </form>
                </div>
            <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" onclick="resetToDefaults()">Reset to Defaults</button>
                    <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Metrics Modal -->
    <div class="modal fade" id="manageMetricsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-sliders me-2"></i>Manage Metrics
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <small>
                            <i class="fas fa-info-circle me-1"></i>
                            Select which metrics to display on your dashboard. Network metrics apply to all networks. Changes apply immediately.
                        </small>
                    </div>

                    <!-- System Metrics Section -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="text-muted mb-0">
                                <i class="fas fa-server me-2"></i>System Metrics
                            </h6>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="nodeManager.selectAllMetrics('system', true)">
                                    Select All
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="nodeManager.selectAllMetrics('system', false)">
                                    Deselect All
                                </button>
                            </div>
                        </div>
                        <div id="systemMetricsList" class="row metric-checkbox-list"></div>
                    </div>

                    <!-- Network Metrics Section -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="text-muted mb-0">
                                <i class="fas fa-network-wired me-2"></i>Network Metrics
                            </h6>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="nodeManager.selectAllMetrics('network', true)">
                                    Select All
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="nodeManager.selectAllMetrics('network', false)">
                                    Deselect All
                                </button>
                            </div>
                        </div>
                        <div id="networkMetricsList" class="row metric-checkbox-list"></div>
                    </div>

                    <!-- Charts & Sections -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="text-muted mb-0">
                                <i class="fas fa-chart-line me-2"></i>Charts & Sections
                            </h6>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="nodeManager.selectAllMetrics('sections', true)">
                                    Select All
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="nodeManager.selectAllMetrics('sections', false)">
                                    Deselect All
                                </button>
                            </div>
                        </div>
                        <div id="sectionsList" class="row metric-checkbox-list"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Node Modal -->
    <div class="modal fade" id="shareNodeModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-share-nodes me-2"></i>Share Node
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="text-muted mb-3">Scan QR code or use the share button</p>
                    <div id="qrCodeContainer" class="mb-4 d-flex justify-content-center"></div>
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" onclick="nodeManager.shareViaShareAPI()">
                            <i class="fas fa-share me-2"></i>Share via Device
                        </button>
                        <button class="btn btn-outline-secondary" onclick="nodeManager.copyShareLink()">
                            <i class="fas fa-copy me-2"></i>Copy Link
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="script.js"></script>
</body>
</html>